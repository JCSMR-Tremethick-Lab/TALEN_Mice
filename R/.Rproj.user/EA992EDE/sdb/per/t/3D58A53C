{
    "collab_server" : "",
    "contents" : "require(rhdf5)\nrequire(sleuth)\nrequire(biomaRt)\n\nsource(\"~/Development/GeneralPurpose/R/heatmap.3.R\")\n\n\n# setting working directory and data sources ------------------------------\nsetwd(\"~/Data/Tremethick/TALENs/NB501086_0047_TSoboleva_JCSMR_stranded_RNASeq/R_analysis\")\nbase_dir <- \"~/Data/Tremethick/TALENs/NB501086_0047_TSoboleva_JCSMR_stranded_RNASeq/processed_data\"\n\n# creating data.frame for experimental design and file names --------------\nsample_id <- dir(base_dir)\nkal_dirs <- sapply(sample_id, function(id) file.path(base_dir, id))\ns2c <- data.frame(sample = sample_id, condition = c(\"KO\", \"WT\", \"WT\", \"KO\", \"WT\", \"KO\"))\ns2c <- dplyr::mutate(s2c, path = kal_dirs)\nx <- s2c$condition\nx <- factor(x, levels(x)[c(2,1)])\ns2c$condition <- x\n\n# transcript level differential expression analysis -----------------------\nso <- sleuth_prep(s2c, ~ condition)\nso <- sleuth_fit(so)\nso <- sleuth_wt(so, \"conditionKO\")\n\n\n# gene level differential expression analysis -----------------------------\n#use Ensembl 74 for annotation\nmouse <- useEnsembl(biomart = \"ensembl\", dataset = \"mmusculus_gene_ensembl\", host = \"dec2013.archive.ensembl.org\")\nattribs <- listAttributes(mouse)\n# annotate transcripts\nt2g <- getBM(attributes = c(\"ensembl_transcript_id\", \"ensembl_gene_id\", \"external_gene_id\"), mart = mouse)\nt2g <- dplyr::rename(t2g, target_id = ensembl_transcript_id, ens_gene = ensembl_gene_id, ext_gene = external_gene_id)\n# re-run sleuth\nso <- sleuth_prep(s2c, ~ condition, target_mapping = t2g)\nso <- sleuth_fit(so)\nso <- sleuth_wt(so, \"conditionKO\")\nresults_table <- sleuth_results(so, \"conditionKO\")\nresults_table$FC_estimated <- log2(exp(results_table$b))\n\nkt <- kallisto_table(so)\n\ntoGrep <- c(\"H2afb3\", \"H2afb2\", \"Gm14920\")\ntoGrep <- t2g[grep(paste(toGrep, collapse = \"|\"), t2g$ext_gene),]$target_id\nkt.goi <- kt[grep(paste(toGrep, collapse = \"|\"), kt$target_id),]\nkt.goi$sample <- factor(kt.goi$sample)\nkt.goi <- spread(kt.goi[, c(\"target_id\", \"sample\", \"tpm\")], sample, tpm)\nrownames(kt.goi) <- kt.goi$target_id\nkt.goi$gene <- t2g[rownames(kt.goi),]$ext_gene\nkt.goi <- kt.goi[, c(\"NMG3-62wt_S2\", \"NMG3-74wt_S3\", \"NMG3-76wt_S5\", \"NMG3-60hemi_S1\", \"NMG3-75hemi_S4\", \"NMG3-77hemi_S6\", \"gene\")]\n\nwrite.csv(kt.goi, \"KO_Gene_expression_levels.csv\")\nwrite.csv(results_table, \"Differential_Expression_WT_vs_KO.csv\")\n",
    "created" : 1460595302091.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "624901111",
    "id" : "3D58A53C",
    "lastKnownWriteTime" : 1460618526,
    "last_content_update" : 1460618526802,
    "path" : "~/OneDrive/Development/JCSMR-Tremethick-Lab/TALEN_Mice/R/kallisto_post_processing.R",
    "project_path" : "kallisto_post_processing.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}